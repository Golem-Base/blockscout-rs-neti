syntax = "proto3";

package blockscout.optimismChildrenIndexer.v1;

option go_package = "github.com/Golem-Base/blockscout-rs-neti/optimism-children-indexer";


service OptimismChildrenIndexerService {
  rpc GetDeposits(PaginationRequest) returns (DepositsResponse);
  rpc GetWithdrawals(PaginationRequest) returns (WithdrawalsResponse);
}

message DepositsResponse {
  repeated Deposit items = 1;
  Pagination pagination = 2;
  optional PaginationNextPage next_page_params = 3;
}

message Deposit {
  TxInfo init_tx = 1;
  string from = 2;
  string to = 3;
  string mint = 4;
  string value = 5;
  string gas_limit = 6;
  bool is_creation = 7;
  optional TxInfo execution_tx = 8;
  optional string destination_chain_id = 9;
}

message TxInfo {
  string transaction_hash = 1;
  string block_hash = 2;
  uint64 block_number = 3;
  string block_timestamp =4;
  string from = 5;
  string to = 6;
  bool success = 7;
}

message WithdrawalsResponse {
  repeated Withdrawal items = 1;
  Pagination pagination = 2;
  optional PaginationNextPage next_page_params = 3;
}

message Withdrawal {
  string chain_id = 1;
  uint64 l3_block_number = 2;
  string l3_block_hash = 3;
  string l3_block_timestamp = 4;
  string l3_tx_hash = 5;
  string nonce = 6;
  string sender = 7;
  string target = 8;
  string value = 9;
  string gas_limit = 10;
  string data = 11;
  string withdrawal_hash = 12;
  optional WithdrawalProving proving_tx = 13;
  optional WithdrawalFinalizing finalizing_tx = 14;
}

message WithdrawalProving {
  TxInfo metadata = 1;
  WithdrawalProvenEvent event = 2;
}

message WithdrawalProvenEvent {
  string withdrawal_hash = 1;
  string from = 2;
  string to = 3;
}

message WithdrawalFinalizing {
  TxInfo metadata = 1;
  WithdrawalFinalizedEvent event = 2;
}

message WithdrawalFinalizedEvent {
  string withdrawal_hash = 1;
  bool success = 2;
}

message PaginationRequest {
  optional uint64 page = 1;
  optional uint64 page_size = 2;
}

message Pagination {
  uint64 page = 1;
  uint64 page_size = 2;
  uint64 total_pages = 3;
  uint64 total_items = 4;
}

message PaginationNextPage {
  uint64 page = 1;
  uint64 page_size = 2;
}
